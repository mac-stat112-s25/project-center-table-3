---
title: "Report"
execute: 
  echo: true      # change to true to show the code
code-fold: false  # change to true to fold the code chunks
---

Your report will go here.

```{r}
# putting all the data shit in one chunk so we can collapse it more easily later
# load presidential election data
library(tidyverse)
library(stringi)
presidencial <- read_delim("data/presidential/PRES_2024.csv", delim = "|", skip = 6, locale = locale(encoding = "latin1"))

presidential <- presidencial |>
  rename(
    casilla_code = CLAVE_CASILLA,
    acta_code = CLAVE_ACTA,
    ID_entity = ID_ENTIDAD,
    entity_state = ENTIDAD,
    ID_federal_district = ID_DISTRITO_FEDERAL,
    federal_district = DISTRITO_FEDERAL,
    section = SECCION,
    casilla_id = ID_CASILLA,
    casilla_type = TIPO_CASILLA,
    ext_contigua = EXT_CONTIGUA,
    casilla = CASILLA,
    acta_type = TIPO_ACTA,
    independent = `CANDIDATO/A NO REGISTRADO/A`,
    null_votes = `VOTOS NULOS`,
    total_votes = TOTAL_VOTOS_CALCULADOS,
    eligible_voters = LISTA_NOMINAL,
    observations = OBSERVACIONES,
    transfer_mechanism = MECANISMOS_TRASLADO,
    date_time = FECHA_HORA
    ) |>
  filter(total_votes != 0) |>
  mutate_at(vars(13:31), as.numeric) |>
  mutate(sheinbaum = PT + MORENA + PVEM_PT_MORENA + PVEM_PT + PVEM_MORENA + PT_MORENA + PVEM) |>
  mutate(galvez = PAN + PAN_PRI_PRD + PAN_PRI + PAN_PRD + PRI + PRI_PRD + PRD) |>
  mutate(maynez = MC)

# clean it again because i realized i wasn't htorough enough the first time but i used the original dataset in my eda
presidential_clean <- presidential |>
  mutate(casilla = fct_recode(casilla, "Non-urban" = "No Urbana", "Urban" = "Urbana")) |>
  mutate(entity_state = str_to_title(entity_state)) |>
  mutate(entity_state = str_replace(entity_state, "Ciudad De México", "Distrito Federal")) |>
  select(casilla_code, acta_code, ID_entity, entity_state, casilla_type, casilla, independent, null_votes, total_votes, eligible_voters, sheinbaum, galvez, maynez) |>
  rename(
    id_state = ID_entity,
    state = entity_state
  )

# IGNORE THE ONE CALLED `presidential_clean.csv`!!!!!!!

# now we're going to upload and clean some statistical data from Mexico
# population by state
population_messy <- read_csv("data/originals/population_state_1020.csv")
population_20 <- population_messy |>
  filter(Year == 2020) |>
  mutate(
    State = str_replace(State, "Ciudad de México", "Distrito Federal"),
    State = str_replace(State, " de Zaragoza", ""),
    State = str_replace(State, "Estado de ", ""),
    State = str_replace(State, " de Ocampo", ""),
    State = str_replace(State, " de Ignacio de la Llave", "")) |>
  rename(
    state = State,
    year = Year,
    id_state = `State ID`,
    pop = Population
  )

# quarterly income by state and year (MXP)
income_messy <- read_csv("data/originals/income_state_1622.csv")
income_16_22 <- income_messy |> # keeping year-by-year data as possible analysis tool
  mutate(
    State = str_replace(State, "Ciudad de México", "Distrito Federal"),
    State = str_replace(State, " de Zaragoza", ""),
    State = str_replace(State, "Estado de ", ""),
    State = str_replace(State, " de Ocampo", ""),
    State = str_replace(State, " de Ignacio de la Llave", "")) |>
  rename(
    state = State,
    year = Year,
    id_state = `State ID`,
    income_quarterly_mxp = `Quarterly Income`
  )

# violent crime by state (data in Spanish)
crimes_messy <- read_csv("data/originals/crimes_state_1524.csv")
violent_crimes_18_23 <- crimes_messy|> # we only want crime data from 2023 as it was before the election, possible avg after 2018
  mutate(
    State = str_replace(State, "Ciudad de México", "Distrito Federal"),
    State = str_replace(State, " de Zaragoza", ""),
    State = str_replace(State, "Estado de ", ""),
    State = str_replace(State, " de Ocampo", ""),
    State = str_replace(State, " de Ignacio de la Llave", "")) |>
  filter(Year %in% c(2019, 2020, 2021, 2022, 2023)) |> #removing data pre-AMLO + election years
  # we will be using the FBI's definition of violent crime to filter the list
  filter(`Crime Type` %in% c("Robo", 
                             "Violación Equiparada", 
                             "Violación Simple", 
                             "Homicidio", 
                             "Lesiones", 
                             "Otros Delitos que Atentan contra la Vida y la Integridad Corporal")) |>
  group_by(State, Year, `State ID`) |>
  summarise(tot_viol_crime = sum(Value)) |>
  rename(
    state = State,
    year = Year,
    id_state = `State ID`
  )
  

# indigenous mexicans (by state, those who speak an indigenous language)
# ¡UNZIP mx_census_2020.csv ZIP FILE TO RUN!
# census_messy <- read_csv("data/originals/mx_census_2020.csv")
# census_messy |>
#   filter(NOM_LOC == "Total de la Entidad") |> # census totals by state
#   mutate(
#     NOM_ENT = str_replace(NOM_ENT, "Ciudad de México", "Distrito Federal"),
#     NOM_ENT = str_replace(NOM_ENT, " de Zaragoza", ""),
#     NOM_ENT = str_replace(NOM_ENT, " de Ocampo", ""),
#     NOM_ENT = str_replace(NOM_ENT, " de Ignacio de la Llave", "")) |>
#   select(1:2, 10, 124:139) |>
#   select(-contains("AFRO"), -ends_with("_M"), -ends_with("_F")) |>
#   rename(
#     id_state = ENTIDAD,
#     state = NOM_ENT,
#     tot_pop = POBTOT,
#     indigenous_hh = PHOG_IND
#   ) |>
#   mutate_at(vars(4:10), as.numeric) |>
#   mutate(pct_indigenous = (indigenous_hh/tot_pop)*100)

# import second indigenous dataset idfk (those who self-identify as indigenous)
library(readxl)
indigenous_messy <- read_excel("data/originals/1-poblacion-indigena-autoadscrita-nacional-y-por-entidad-federativa-muestra-censal-2020.xlsx", 
    skip = 3)
indigenous_pop_24 <- indigenous_messy |>
  filter(!is.na(Entidad)) |>
  filter(Entidad != "Estados Unidos Mexicanos") |>
  mutate(
    Entidad = str_replace(Entidad, "Ciudad de México", "Distrito Federal"),
    Entidad = str_replace(Entidad, " de Zaragoza", ""),
    Entidad = str_replace(Entidad, " de Ocampo", ""),
    Entidad = str_replace(Entidad, " de Ignacio de la Llave", "")) |>
  filter(Estimador == "Estimación") |>
  select(`Clave de la entidad`, Entidad, Tipo, `Se considera indígena`) |>
  pivot_wider(names_from = Tipo, values_from = `Se considera indígena`) |>
  rename(
    id_state = `Clave de la entidad`,
    state = Entidad,
    pop_ind = Población,
    pct_ind = Porcentaje
  )
```
